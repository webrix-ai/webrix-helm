# Global configuration
global:
  # Database provider: "postgresql" for in-cluster db, or "external" for external db
  db_provider: "postgresql" # postgresql | external

  # External database URL (alternative to externalDatabase configuration)
  external_db_url: ""

  # Global domain configuration
  domain:
    host: "example.com"

  ON_PREM: true
  ORG: "on-prem-org"

  authSecret: "aUi2V5iCVqUrbrdjKty1zH4HCqszXArV9BLVU2giqhY="
  dbAuthSecret: ZI39UlR2sN6HFZauuze0iNEZnNkF1wiOuGklm3bC8dk=

  # Common labels applied to all resources
  labels: {}

  # Common annotations applied to all resources
  annotations: {}

  sharedEnv: {}
# Application deployments configuration
deployments:
  app:
    enabled: true
    replicas: 1
    image:
      repository: "quay.io/webrix/mcp-s-app"
      tag: "latest"

    service:
      port: 80
      targetPort: 3000

    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 2048Mi

    nodeSelector: {}
    tolerations: []
    affinity: {}

    podAnnotations: {}
    podLabels: {}

    serviceAccount:
      create: true
      annotations: {}
      name: ""

    env:
      PORT: "3000"
    
    # Optional: SealedSecret configuration
    # sealedsecret:
    #   KEY: "encrypted-value"

    # Health check probes
    readinessProbe: {}
    livenessProbe: {}

    # Optional: name of an existing secret to mount as environment variables
    # secretName: "my-existing-secret"

    ingress:
      enabled: true
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/rewrite-target: /
      subdomain: "webrix-admin"
      path: "/"
      pathType: "Prefix"
      tls: []

  connect:
    enabled: true
    replicas: 1
    image:
      repository: "quay.io/webrix/mcp-s-connect"
      tag: "latest"

    service:
      port: 80
      targetPort: 3000

    resources:
      requests:
        cpu: 500m
        memory: 500Mi
      limits:
        cpu: 1000m
        memory: 4048Mi

    nodeSelector: {}
    tolerations: []
    affinity: {}

    podAnnotations: {}
    podLabels: {}

    serviceAccount:
      create: true
      annotations: {}
      name: ""

    env:
      PORT: "3000"
      AUTH_TRUST_HOST: "true"

    # Health check probes
    readinessProbe: {}
    livenessProbe: {}

    ingress:
      enabled: true
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/rewrite-target: /
      subdomain: "webrix-dashboard"
      path: "/"
      pathType: "Prefix"
      tls: []

  run:
    enabled: true
    replicas: 4
    image:
      repository: "quay.io/webrix/mcp-s-run"
      tag: "latest"

    service:
      port: 80
      targetPort: 3000

    resources:
      requests:
        cpu: 1000m
        memory: 500Mi
      limits:
        cpu: 2000m
        memory: 8192Mi

    nodeSelector: {}
    tolerations: []
    affinity: {}

    podAnnotations: {}
    podLabels: {}

    serviceAccount:
      create: true
      annotations: {}
      name: ""

    env:
      PORT: "3000"
      LOG_LEVEL: "info"

    # Health check probes
    readinessProbe: {}
    livenessProbe: {}

    ingress:
      enabled: true
      className: "nginx"
      annotations:
        nginx.ingress.kubernetes.io/rewrite-target: /
      subdomain: "webrix"
      path: "/"
      pathType: "Prefix"
      tls: []

  db-service:
    enabled: true
    replicas: 3
    image:
      repository: "quay.io/webrix/mcp-s-db-service"
      tag: "latest"

    # Database configuration for db-service
    db:
      user: "postgres"
      password: "postgres"
      port: 5432
      name: "postgres"

    service:
      port: 80
      targetPort: 3000

    resources:
      requests:
        cpu: 1000m
        memory: 500Mi
      limits:
        cpu: 2000m
        memory: 8192Mi

    nodeSelector: {}
    tolerations: []
    affinity: {}

    podAnnotations: {}
    podLabels: {}

    serviceAccount:
      create: true
      annotations: {}
      name: ""

    env:
      PORT: "3000"
      POSTGRES_HOST_AUTH_METHOD: "trust"
      RATE_LIMIT_MAX: "1000"
      RATE_LIMIT_WINDOW: "60000"
      # DATABASE_URL: "postgres://postgres:postgres@webrix-postgresql:5432/postgres?sslmode=disable"
      AUTO_AUTHENTICATE_TOKEN: "balQgAqCpKW979XoibTYSbfCjvj7uSJK+90m0iQG5"
      ENCRYPTION_KEY: "iL7wUJhqRMPFY0asXqLAn1JjW9kv0OqC4NHtqKHt5VY="

    # Health check probes
    readinessProbe:
      httpGet:
        path: /readyz
        port: 3000
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 5
      failureThreshold: 10
    livenessProbe:
      httpGet:
        path: /healthz
        port: 3000
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3

    ingress:
      enabled: false

# PostgreSQL configuration
postgresql:
  enabled: false
  global:
    security:
      allowInsecureImages: true
  fullnameOverride: "webrix-postgresql"
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: "17.6.0"
  auth:
    enablePostgresUser: true
    postgresPassword: "postgres"

  primary:
    resourcesPreset: "small"
    persistence:
      enabled: true
      size: 8Gi
      storageClass: ""

  readReplicas:
    replicaCount: 0

  service:
    ports:
      postgresql: 5432

  metrics:
    enabled: false

  architecture: standalone

  postgresqlConfiguration:
    listen_addresses: "'*'"
    max_connections: "200"

# External database configuration (when db_provider is "external")
externalDatabase:
  # Option 1: Provide a complete database URL
  url: ""

  # Option 2: Provide individual components (used if url is empty)
  host: ""
  port: 5432
  database: "postgres"
  username: "postgres"
  password: ""
  sslMode: "disable"
